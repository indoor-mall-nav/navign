# TypeScript Schema Generator

This crate generates TypeScript type definitions from Rust types in the `shared` crate using [ts-rs](https://github.com/Aleph-Alpha/ts-rs).

## Generated Types

The following TypeScript definitions are automatically generated from Rust structs and enums:

- **Entity** and **EntityType**
- **Area**, **Floor**, and **FloorType**
- **Beacon**, **BeaconDevice**, and **BeaconType**
- **Merchant**, **MerchantType**, **MerchantStyle**, **FoodType**, **FoodCuisine**, **ChineseFoodCuisine**, **FacilityType**
- **SocialMedia** and **SocialMediaPlatform**
- **Connection** and **ConnectionType**

## Usage

### Generate TypeScript Definitions

Run the following command from the workspace root:

```bash
just gen-ts-schema
```

Or manually:

```bash
cd shared && cargo test --features ts-rs
mkdir -p mobile/src/schema/generated
cp ts-schema/bindings/generated/*.ts mobile/src/schema/generated/
```

This will generate `.ts` files in `mobile/src/schema/generated/`.

## How It Works

1. Types in `shared/src/schema/` are annotated with `#[cfg_attr(feature = "ts-rs", derive(ts_rs::TS))]`
2. The `ts-rs` feature flag is enabled when running tests
3. During compilation, ts-rs generates TypeScript definitions based on the Rust types
4. Files are output to `ts-schema/bindings/generated/`
5. The justfile task copies them to `mobile/src/schema/generated/`

## Features

- **Type Safety**: Ensures TypeScript types match Rust types exactly
- **Auto-generated**: No manual maintenance required
- **ObjectId Mapping**: MongoDB `ObjectId` fields are automatically converted to `string` in TypeScript
- **Doc Comments**: Rust doc comments are preserved in TypeScript
- **Type Imports**: Related types are automatically imported

## Adding New Types

To add a new type for TypeScript generation:

1. Add the type to `shared/src/schema/`
2. Add these derive attributes:
   ```rust
   #[cfg_attr(feature = "ts-rs", derive(ts_rs::TS))]
   #[cfg_attr(feature = "ts-rs", ts(export, export_to = "generated/"))]
   pub struct MyType {
       // For ObjectId fields, add:
       #[cfg_attr(feature = "ts-rs", ts(type = "string"))]
       pub id: ObjectId,
       // ... other fields
   }
   ```
3. Re-export the type in `shared/src/schema/mod.rs`
4. Re-export in `ts-schema/src/lib.rs` (automatic via `pub use navign_shared::schema::*`)
5. Run `just gen-ts-schema`

## Output Location

- **Generated by ts-rs**: `ts-schema/bindings/generated/*.ts`
- **Copied to mobile**: `mobile/src/schema/generated/*.ts`

The justfile task handles both generation and copying automatically.
